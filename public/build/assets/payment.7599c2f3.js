$(document).ready(function(){const a=window.location.origin,n=JSON.parse(document.getElementsByClassName("games-info__body")[0].dataset.game),t=JSON.parse(document.getElementById("nav-tab-payment").dataset.paymentcategory),e=JSON.parse(document.getElementsByClassName("player-input")[0].dataset.infotext);let d;$(".input-feedback.input-id-player").text(e.infoTextInput.idPlayer),$(".input-feedback.input-country").text(e.infoTextInput.country),$(".modal-body #nameGame span").text(n.title),$(".modal-body #nameGame :input").val(n.id),$("#nav-tab-payment").hide(),$(".info-payment").hide(),$("#formCheckout").hide(),v();const s=l=>{$("#modalPaymentLabel").text(),$("#modalPaymentLabel").text(l)},p=({showElement:l=null,hideElement:o=null})=>{$(l).show(),$(o).hide()};x(t),p({showElement:"#formCheckout"}),$("#btnConfirm").prop("disabled",!1),$("#btnConfirm").click(function(){if(s(e.titleModal.alertInfo),$("#idPlayer").val()==""){p({showElement:"#infoCaution",hideElement:"#formCheckout"}),$(".info-caution__empty-country, .info-caution__empty-payment, .info-caution__empty-item").attr("hidden",!0),$(".info-caution__empty-player").removeAttr("hidden").text(e.alert.idPlayer);return}if($(".modal-body #playerName input[name=username]").val()==""&&$("#idPlayer").val()!=""){p({showElement:"#infoCaution",hideElement:"#formCheckout"}),$(".info-caution__empty-country, .info-caution__empty-payment, .info-caution__empty-item").attr("hidden",!0),$(".info-caution__empty-player").removeAttr("hidden").text(e.alert.checkIdPlayer);return}if($(".input-form__country .form-select").val()==""||!$(".input-form__country .form-select").val()){p({showElement:"#infoCaution",hideElement:"#formCheckout"}),$(".info-caution__empty-player, .info-caution__empty-payment, .info-caution__empty-item").attr("hidden",!0),$(".info-caution__empty-country").removeAttr("hidden").text(e.alert.country);return}if($(".modal-body #payment input[name=payment]").val()==""||$(".payment-list").children().length<=0){p({showElement:"#infoCaution",hideElement:"#formCheckout"}),$(".info-caution__empty-player, .info-caution__empty-country, .info-caution__empty-item").attr("hidden",!0),$(".info-caution__empty-payment").removeAttr("hidden").text(e.alert.payment);return}if($(".modal-body #price input[name=price]").val()==""){p({showElement:"#infoCaution",hideElement:"#formCheckout"}),$(".info-caution__empty-player, .info-caution__empty-country, .info-caution__empty-payment").attr("hidden",!0),$(".info-caution__empty-item").removeAttr("hidden").text(e.alert.item);return}if($(".phone").length>0){if(console.log($(".phone")),$(".modal-body #phone").length<=0){h(),$(".modal-body #phone span").text($(".phone input[name=phone]").val()),$(".modal-body #phone input[name=phone]").val($(".phone input[name=phone]").val()),console.log($(".phone input[name=phone]").val());return}console.log($(".phone input[name=phone]").val()),$(".modal-body #phone span").text($(".phone input[name=phone]").val()),$(".modal-body #phone input[name=phone]").val($(".phone input[name=phone]").val())}s(e.titleModal.purchase),p({showElement:"#formCheckout",hideElement:"#infoCaution"})}),$(".total-payment__nominal").text(0),$("#idGameInpt").val(n.id),$("#btnClearId").hide(),$("#btnCheckId").click(async function(l){if(!$("#idPlayer").val()){$(".input-feedback.input-id-player").addClass("invalid"),$(".input-feedback.input-id-player").text(e.infoTextInput.warning);return}await fetch(`${a}/api/v1/player`).then(o=>{if(o.status===404){$(".input-feedback.input-id-player").removeClass("valid invalid"),$(".input-feedback.input-id-player").addClass("invalid"),$(".input-feedback.input-id-player").text(e.infoTextInput.playerNotFound),$("#formCheckout").children("div").last().remove(),$("#formCheckout").append('<div class="info-user">Data user tidak tersedia, silahkan coba kembali</div>');return}return o.json()}).then(o=>{$(this).hide(),d=o.data,$(".input-feedback.input-id-player").removeClass("valid invalid"),$(".input-feedback.input-id-player").addClass("valid"),$(".input-feedback.input-id-player").text(`Player name: ${d.username}`),$("#btnClearId").show(),$(".modal-body #playerId :input").val($("#idPlayer").val()),$(".modal-body #playerId span").text($("#idPlayer").val()),$(".modal-body #playerName :input").val(d.username),$(".modal-body #playerName span").text(d.username),$(".modal-body #emailInpt :input").val(d.email),$(".modal-body #emailInpt span").text(d.email),$("#idPlayer").prop("disabled",!0)}).catch(o=>{console.error(o)})}),$("#btnClearId").click(function(){$(this).hide(),$("#btnCheckId").show(),$("#idPlayer").prop("disabled",!1),$("#idPlayer").val(""),$(".input-feedback.input-id-player").removeClass("valid invalid"),$(".input-feedback.input-id-player").text(e.infoTextInput.idPlayer),$("#formCheckout").children(".info-user").remove(),C()}),$(".input-form__country .form-select").change(async function(){$("#paymentLoader, #paymentLoader .spinner-border").addClass("mt-5").show(),$("#nav-tab-payment").hide(),$(".info-payment").hide(),$(".info-payment").empty(),$(".payment-list").empty(),$(".price-list").empty(),$(".phone").empty(),_(),this.value&&await fetch(`${a}/api/v1/payment?country=${this.value}&game_id=${n.id}`).then(l=>{if(l.status===404){c({element:".info-payment",addClass:"justify-content-center"}),$("#nav-tab-payment").hide(),$(".info-payment").show(),$(".info-payment").empty(),$(".info-payment").append(e.noPayment);return}return l.json()}).then(l=>{$("#nav-tab-payment").show(),$(".info-payment").hide(),c({element:".payment-list",addClass:"justify-content-start",removeClass:"justify-content-center"});const o=l.data;$("#paymentLoader, #paymentLoader .spinner-border").removeClass("mt-5").hide(),$(".payment-list").empty(),$("#nav-tab .nav-link").click(function(){f({classElement:"phone"}),$(".price-list").empty(),$(".payment-list__items").children().prop("checked",!1),m()}),o.map(({payment:r})=>{b(r)}),$("#formCheckout").hide(),$("#infoCaution").show(),$(".payment-list__items").click(function(){m(),$(".modal-body #phone").remove(),$(this).children().prop("checked",!0);const{payment:r,price:u}=o.find(({payment:i})=>i.payment_id==this.dataset.payment);y(r),$(".price-list").empty(),$(".modal-body #payment span").text(r.name_channel),$(".modal-body #payment input[name=payment]").val(r.name_channel),$(".modal-body #payment input[name=payment_id]").val(r.payment_id),$("#formCheckout").hide(),$("#infoCaution").show(),u.map(i=>{$(".price-list").append(`<div class="col"><div class="amount-price__wrap d-flex justify-content-between p-2" data-priceid="${i.price_id}"><div class="amount-price__name-item"><input type="radio" id="${i.price_id}" name="price-id" value="${i.price_id}"> ${i.amount} ${i.name}</div><div class="amount-price__price" id="price">${i.price}</div></div></div>`)}),$(".amount-price__wrap").click(function(){$(this).children(".amount-price__name-item").children().prop("checked",!0);const i=parseInt($(this).children(".amount-price__price").text());$(".total-payment__nominal").text(i),$(".modal-body #price :input").val(i),$(".modal-body #price span").text(i),$(".modal-body #amount input[name=amount]").val($(this).children(".amount-price__name-item").text()),$(".modal-body #amount span").text($(this).children(".amount-price__name-item").text()),$(".modal-body #priceId").val($(this).children(".amount-price__name-item").children("input").val()),$("#formCheckout").show(),$("#infoCaution").hide()})})}).catch(l=>{$("#nav-tab-payment").hide(),$("#paymentLoader, #paymentLoader .spinner-border").removeClass("mt-5").hide(),$(".payment-list").empty(),$(".payment-list").addClass("justify-content-center"),$(".payment-list").append(e.noPayment),$(".price-list").empty(),$(".info-payment").show()})})});const y=({phone_required:a})=>{if(a){$(".phone").show();return}$(".phone").hide()},h=()=>{$(".modal-body .checkout-confirm__info").before(`
    <div class="row justify-content-around mb-2" id="phone">
      <div class="col-6">
        Phone :
      </div>
      <div class="col-4 text-end">
        <span></span>
      </div>
      <input type="text" name="phone" hidden>
    </div>
  `)},v=()=>{$(".phone").append(`<div class="col col-md-4 input-group">
  <div class="input-form__phone row px-2 pt-3 pt-md-0 ps-md-3">
  <input type="text" class="form-control" aria-label="phone number" aria-describedby="inputGroup-sizing-sm" placeholder="Phone Number" name="phone">
  <div class="input-feedback ps-1 py-0">Please insert phone number</div>
  </div>
  </div>`),$(".phone").hide()},f=({idElement:a=null,classElement:n=null})=>{a&&$("#"+a).remove(),n&&$("."+n).remove()},b=({category_id:a,payment_id:n,name_channel:t,logo_channel:e})=>{$("#nav-"+a+" .payment-list").append(`<div class="col"><div class="payment-list__items" data-payment="${n}"><input type="radio" id="${n}" name="payment-id" value="${n}"><img src="${e}" title="${t}" alt="${t}" class="ps-2"></div></div>`)},_=()=>{$(".modal-body #payment span").text(""),$(".modal-body #payment input[name=payment]").val(""),$(".modal-body #payment input[name=payment_id]").val(""),$(".modal-body #amount span").text(""),$(".modal-body #amount :input").val(""),$(".modal-body #phone").remove(),m()},m=()=>{$(".phone-test").hide(),$(".modal-body #price span").text(""),$(".modal-body #price input[name=price]").val(""),$(".total-payment__nominal").text("0")},C=()=>{$(".modal-body #playerId :input").val($("#idPlayer").val()),$(".modal-body #playerId span").text($("#idPlayer").val()),$(".modal-body #playerName :input").val(""),$(".modal-body #playerName span").text("")},c=({element:a=null,addClass:n=null,removeClass:t=null})=>{$(a).removeClass(t),$(a).addClass(n)},x=a=>{a.map(({category:n,id:t},e)=>{if(e==0){$("#nav-tab").append(`<button class="nav-link active" id="nav-${t}-tab" data-bs-toggle="tab" data-bs-target="#nav-${t}" type="button" role="tab" aria-controls="nav-${t}" aria-selected="true">${n}</button>`),$("#nav-tabContent").append(`<div class="tab-pane fade show active" id="nav-${t}" role="tabpanel" aria-labelledby="nav-${t}-tab" tabindex="0"><div class="payment-list row row-cols-2 row-cols-md-3 row-cols-xl-4 g-2"></div></div>`);return}$("#nav-tab").append(`<button class="nav-link" id="nav-${t}-tab" data-bs-toggle="tab" data-bs-target="#nav-${t}" type="button" role="tab" aria-controls="nav-${t}" aria-selected="true">${n}</button>`),$("#nav-tabContent").append(`<div class="tab-pane fade show" id="nav-${t}" role="tabpanel" aria-labelledby="nav-${t}-tab" tabindex="0"><div class="payment-list row row-cols-2 row-cols-md-3 row-cols-xl-4 g-2"></div></div>`)})};
